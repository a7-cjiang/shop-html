<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">

	<head>
		<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
		<title>结算</title>
		<link rel="stylesheet" type="text/css" href="css/style.css">
		<link rel="stylesheet" type="text/css" href="css/css.css" />
		<script type="text/javascript" src="js/jquery-3.3.1.min.js"></script>
	</head>

	<body>
		<div id="top">
			<div id="top_main">
				<ul class="topu">
					<li>
						<div class="xing">
						</div>
						<a href="#">收藏商城</a>
					</li>
				</ul>
				<div id="hello">
					<span>您好，欢迎来到商城！
			<a href="login.html">[登陆]</a><a href="login.html">[免费注册]</a>
			</span>
				</div>
				<div class="topright">
					<ul>
						<li>
							<div class="cun">
								<a href="#">我的订单</a>
							</div>
						</li>
						<li class="kefu">
							<div class="cun">
								<div class="a1">
									<div class="kefuhide">
										<span>客户服务</span>
										<div class="downjian1">
										</div>
										<ul>
											<li><a href="#">帮助中心</a></li>
											<li><a href="#">售后服务</a></li>
											<li><a href="#">在线客服</a></li>
											<li><a href="#">投诉中心</a></li>
											<li><a href="#">客服邮箱</a></li>
										</ul>
									</div>
								</div>
							</div>
						</li>
						<li class="wangzhan">
							<div class="cun">
								<span>网站导航</span>
								<div class="downjian1">
								</div>
							</div>
							<div class="wangzhanhide">
								<div class="tese">
									<span>特色栏目</span>
								</div>
								<div class="tesemain">
									<a href="#">商城通信</a>
									<a href="#">校园之星</a>
									<a href="#">视频购物</a>
									<a href="#">商城社区</a>
									<a href="#">在线读书</a>
									<a href="#">装机大师</a>
									<a href="#">商城E卡　</a>
									<a href="#">家装城</a>
									<a href="#">搭配购　</a>
									<a href="#">我喜欢　</a>
									<a href="#">游戏社区</a>
								</div>
								<div class="tese">
									<span>企业服务</span>
								</div>
								<div class="tesemain1">
									<a href="#">企业采购</a>
									<a href="#">办公直通车</a>
								</div>
								<div class="tese">
									<span>旗下网站</span>
								</div>
								<div class="tesemain2">
									<a href="#">English Site</a>
								</div>
							</div>
						</li>
					</ul>
				</div>
			</div>
		</div>
		<!-- 搜索区域开始 -->
		<div id="serach">
			<div class="logo">
				<a href="index.html">
					<img src="images/logo.png" alt="" /></a>
				<div class="dongtu">
				</div>
			</div>
			<div class="sou">
				<div class="sousuo">
					<input type="text" class="kuang" value="跨界" style="color:#999;font-size:14px" />
					<div class="souzi">
						<a href="#">搜索</a>
					</div>
				</div>
				<div class="reci">
					<span>热门搜索:</span>
					<a href="#" style="color:red">校园之星</a>
					<a href="#">影院到家</a>
					<a href="#">JD制暖节</a>
					<a href="#">腕表领券</a>
					<a href="#">自营满减</a>
					<a href="#">N3抢购</a>
					<a href="#">图书换购</a>
					<a href="#">12.12</a>
				</div>
			</div>
			<div class="myjd">
				<div class="mytu">
				</div>
				<a href="commodity.html">我的商城</a>
				<div class="jiantou">
				</div>
				<div class="myjdhide">
					<div class="hello">
						<span>您好，请</span>
						<a href="#">登录</a>
					</div>
					<div class="hey">
						<div class="heyleft">
							<ul>
								<li><a href="#">待处理订单</a></li>
								<li><a href="#">咨询回复</a></li>
								<li><a href="#">降价商品</a></li>
								<li><a href="#">返修退换货</a></li>
								<li><a href="#">优惠券</a></li>
							</ul>
						</div>
						<div class="heyright">
							<ul>
								<li><a href="#">我的关注></a></li>
								<li><a href="#">我的京豆></a></li>
								<li><a href="#">我的理财></a></li>
								<li><a href="#">我的白条></a></li>
							</ul>
						</div>
					</div>
					<div class="hidebot">
						<div class="bottop">
							<span>最近浏览的商品:</span>
							<a href="#">查看浏览历史></a>
						</div>
						<div class="botdown">
							<span>「暂无数据」</span>
						</div>
					</div>
				</div>
			</div>
			<div class="gouwuche">
				<div class="chetu">
				</div>
				<a href="shopcart.html">去购物车结算</a>
				<div class="jianleft">
				</div>
				<div class="num">
					<div class="numright">
					</div>
					<div class="numzi">
						<span>0</span>
					</div>
				</div>
				<div class="hideche">
					<div class="kongche">
					</div>
					<span>购物车中还没有商品，赶紧选购吧！</span>
				</div>
			</div>
			<div class="jubao">
			</div>
		</div>
		<div class="Caddress" id="areaAddRess">
			<div class="open_new" >
				<button class="open_btn" onclick="javascript:onclick_open();">使用新地址</button>
			</div>
			<div class="add_mi"  style="">
				<p><input type="radio" value="1" name="radio"/></p>
				<p style="border-bottom:1px dashed #ccc;line-height:28px;">浙江杭州(爸爸收)</p>
				<p>萧山 北干 明怡花苑53幢3单元 13735683918</p>
			</div>
		</div>


		<!--
        	作者：z@163.com
        	时间：2016-03-04
        	描述：商品内容
        -->
		<div class="shopping_content">
			<div class="shopping_table">
				<table id="cartDiv" border="1" bordercolor="#cccccc" cellspacing="0" cellpadding="0" style="width: 100%; text-align: center;">
					<tr>
						<th>商品图片</th>
						<th>商品名称</th>
						<th>商品属性</th>
						<th>商品价格</th>
						<th>商品数量</th>
						<th>商品操作</th>
					</tr>


				</table>
				<div class="" style="width: 100%; text-align: right; margin-top: 10px;">
					<div class="div_outMumey" style="float: left;">
						总价：<span class="out_momey" id="zhongjia">11</span>
					</div>
					<div class="" style="float: left; margin-top: 10px; margin-left: 740px">
						支付方式：<input type="radio" value="1" checked name="zhifu_ssn"/>微信支付<input type="radio" value="2" name="zhifu_ssn"/>支付宝支付
					</div>

					<button class="btn_closing" onclick="creatOrder()">结算</button>
				</div>
			</div>
		</div>




		<div class="shade_content">
			<div class="col-xs-12 shade_colse">
				<button onclick="javascript:onclick_close();">x</button>
			</div>
			<div class="nav shade_content_div">
				<div class="col-xs-12 shade_title">
					新增收货地址
				</div>
				<div class="col-xs-12 shade_from">
					<form action="" method="post">
						<div class="col-xs-12">
							<span class="span_style" id="q">地&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;区</span>
							<input class="input_style" type="" name="" id="region" value="" placeholder="&nbsp;&nbsp;请输入您的所在地区" />
						</div>
						<div class="col-xs-12">
							<span class="span_style" id="w">详细地址</span>
							<input class="input_style" type="" name="" id="address" value="" placeholder="&nbsp;&nbsp;请输入您的详细地址" />
						</div>
						<div class="col-xs-12">
							<span class="span_style" id="e">邮政编号</span>
							<input class="input_style" type="" name="" id="number_this" value="" placeholder="&nbsp;&nbsp;请输入您的邮政编号" />
						</div>
						<div class="col-xs-12">
							<span class="span_style" class="span_sty" id="r">姓&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;名</span>
							<input class="input_style" type="" name="" id="name_" value="" placeholder="&nbsp;&nbsp;请输入您的姓名" />
						</div>
						<div class="col-xs-12">
							<span class="span_style" id="t">手机号码</span>
							<input class="input_style" type="" name="" id="phone" value="" placeholder="&nbsp;&nbsp;请输入您的手机号码" />
						</div>
						<div class="col-xs-12">
							<input class="btn_remove" type="button" id="y" onclick="javascript:onclick_close();" value="取消" />
							<input type="submit" class="sub_set" id="sub_setID" value="提交" />
						</div>
					</form>
				</div>
			</div>
		</div>

		<!-- 底部开始 -->
		<div id="down">
			<div class="down_top">
				<a href="#">关于我们</a>
				<a href="#">联系我们</a>
				<a href="#">商家入驻</a>
				<a href="#">营销中心</a>
				<a href="#">手机商城</a>
				<a href="#">友情链接</a>
				<a href="#">销售联盟</a>
				<a href="#">商城社区</a>
				<a href="#">商城公益</a>
				<a href="#" style="border-right:none">English Site</a>
			</div>
			<div class="down_center">
				<span>北京市公安局朝阳分局备案编号110105014669  |  京ICP证070359号  |  <a href="#">互联网药品信息服务资格证编号(京)-经营性-2014-0008</a>  |  新出发京零 字第大120007号</span>
				<span><a href="#">音像制品经营许可证苏宿批005号</a>  |  出版物经营许可证编号新出发(苏)批字第N-012号  |  互联网出版许可证编号新出网证(京)字150号</span>
				<span><a href="#">网络文化经营许可证京网文[2011]0168-061号</a>  违法和不良信息举报电话：4006561155  Copyright © 2004-2014  商城JD.com 版权所有</span>
				<span>商城旗下网站：<a href="#">360TOP</a><a href="#">拍拍网</a><a href="#">网银在线</a></span>
			</div>
			<div class="down_bot">
				<img src="images/bot1.gif" alt="" />
				<img src="images/bot2.gif" alt="" />
				<img src="images/bot3.png" alt="" />
				<img src="images/bot4.png" alt="" />
			</div>
		</div>
		<!-- 底部结束 -->



		<script type="text/javascript">

            // 进行ajax的全局设置
            $.ajaxSetup({
                //data:{"name":sessionStorage.getItem("token")}
                headers: {
                    'token': sessionStorage.getItem("login_token")
                },
                //数据加载完成后
                complete:function(a,b,c){
                    var data=a.responseJSON;
                    if(data.code==1000){
                        alert(data.message);
                        location.href="login.html"
                    }
                    //debugger
                }
                /* beforeSend: function(xhr) {
                     debugger;
                     xhr.setRequestHeader("token:'"+sessionStorage.getItem("login_token")+"'");
                 }*/
            });



            $(function() {
                var region = $("#region");
                var address = $("#address");
                var number_this = $("#number_this");
                var name = $("#name_");
                var phone = $("#phone");
                $("#sub_setID").click(function() {
                    var input_out = $(".input_style");
                    for (var i = 0; i <= input_out.length; i++) {
                        if ($(input_out[i]).val() == "") {
                            $(input_out[i]).css("border", "1px solid red");

                            return false;
                        } else {
                            $(input_out[i]).css("border", "1px solid #cccccc");
                        }
                    }
                });
                var span_momey = $(".span_momey");
                var b = 0;
                for (var i = 0; i < span_momey.length; i++) {
                    b += parseFloat($(span_momey[i]).html());
                }
                var out_momey = $(".out_momey");
                out_momey.html(b);
                $(".shade_content").hide();
                $(".shade").hide();
                $('.nav_mini ul li').hover(function() {
                    $(this).find('.two_nav').show(100);
                }, function() {
                    $(this).find('.two_nav').hide(100);
                })
                $('.left_nav').hover(function() {
                    $(this).find('.nav_mini').show(100);
                }, function() {
                    $(this).find('.nav_mini').hide(100);
                })
                $('#jia').click(function() {
                    $('input[name=num]').val(parseInt($('input[name=num]').val()) + 1);
                })
                $('#jian').click(function() {
                    $('input[name=num]').val(parseInt($('input[name=num]').val()) - 1);
                })
                $('.Caddress .add_mi').click(function() {
                    $(this).css('background', 'url("images/mail_1.jpg") no-repeat').siblings('.add_mi').css('background', 'url("images/mail.jpg") no-repeat')
                })
            })
            var x = Array();

            function func(a, b) {
                x[b] = a.html();
                alert(x)
                a.css('border', '2px solid #f00').siblings('.min_mx').css('border', '2px solid #ccc');
            }

            function onclick_close() {
                var shade_content = $(".shade_content");
                var shade = $(".shade");
                if (confirm("确认关闭么！此操作不可恢复")) {
                    shade_content.hide();
                    shade.hide();
                }
            }

            function onclick_open() {
                $(".shade_content").show();
                $(".shade").show();
                var input_out = $(".input_style");
                for (var i = 0; i <= input_out.length; i++) {
                    if ($(input_out[i]).val() != "") {
                        $(input_out[i]).val("");
                    }
                }
            }

            function onclick_remove(r) {
                if (confirm("确认删除么！此操作不可恢复")) {
                    var out_momey = $(".out_momey");
                    var input_val = $(r).parent().prev().children().eq(1).val();
                    var span_html = $(r).parent().prev().prev().children().html();
                    var out_add = parseFloat(input_val).toFixed(2) * parseFloat(span_html).toFixed(2);
                    var reduce = parseFloat(out_momey.html()).toFixed(2)- parseFloat(out_add).toFixed(2);
                    console.log(parseFloat(reduce).toFixed(2));
                    out_momey.text(parseFloat(reduce).toFixed(2))
                    $(r).parent().parent().remove();
                }
            }

            function onclick_btnAdd(a) {
                var out_momey = $(".out_momey");
                var input_ = $(a).prev();
                var input_val = $(a).prev().val();
                var input_add = parseInt(input_val) + 1;
                input_.val(input_add);
                var btn_momey = parseFloat($(a).parent().prev().children().html());
                var out_momey_float = parseFloat(out_momey.html()) + btn_momey;
                out_momey.text(out_momey_float.toFixed(2));
            }

            function onclick_reduce(b) {
                var out_momey = $(".out_momey");
                var input_ = $(b).next();
                var input_val = $(b).next().val();
                if (input_val <= 1) {
                    alert("商品个数不能小于1！")
                } else {
                    var input_add = parseInt(input_val) - 1;
                    input_.val(input_add);
                    var btn_momey = parseFloat($(b).parent().prev().children().html());
                    var out_momey_float = parseFloat(out_momey.html()) - btn_momey;
                    out_momey.text(out_momey_float.toFixed(2));
                }
            }














            var flag


            $(function () {
				initCart()
				flag = new Date().getTime()
            })

            var tomoney = 0;
			function initCart() {

                //商品展示
                $.get({
                    url:"http://192.168.1.160:8088/cart/getCheckCartStatus.do",
                    dataType:"json",
                    success:function (data) {
                        if (data.code == 200){
                            tomoney = 0;
                            var htmls = ""
                            for (var i = 0; i < data.data.length ; i++) {
                                var pro = data.data[i]
                                htmls += '<tr>\n' +
                                    '\t\t\t\t\t\t<th><img src="'+pro.img+'" width="100"></th>\n' +
                                    '\t\t\t\t\t\t<th>'+pro.name+'</th>\n' +
                                    '\t\t\t\t\t\t<th>'+pro.price+'</th>\n' +
                                    '\t\t\t\t\t\t<th>'+pro.count+'</th>\n' +
                                    '\t\t\t\t\t\t<th>'+pro.money+'</th>\n' +
                                '\t\t\t\t\t</tr>'

                                tomoney += pro.money
                            }
                            $("#cartDiv").html(htmls)
							$("#zhongjia").text(tomoney)
						}

                    },error:function () {
                        alert("获取订单数据异常")
                    }
                })


				//收件地址展示
                $.get({
                    url:"http://192.168.1.160:8088/addRess/getAddressVoList.do",
                    dataType:"json",
                    success:function (data) {
                        if (data.code == 200){
                            var htmls = ""

                            var ischeck =""

                            for (var i = 0; i < data.data.length ; i++) {

                                var address = data.data[i]

                                if (address.isCheck == 1){
                                    ischeck = '<p><input type="radio" value="'+address.id+'" checked name="isChick"/></p>'
                                }else {
                                    ischeck = '<p><input type="radio" value="'+address.id+'" name="isChick"/></p>'
                                }

                                    htmls += '<div class="add_mi"  style="display:inline-block">' +
										ischeck +
									'<p style="border-bottom:1px dashed #ccc;line-height:28px;">'+address.name+'</p>\n' +
                                    '\t\t\t\t<p>'+address.address+' '+address.phone+'</p>' +
									'</div>'
                            }
                            $("#areaAddRess").html(htmls)
                        }

                    },error:function () {
                        alert("获取收件地址数据异常")
                    }
                })

            }



            function creatOrder() {

                //获取选中的收货地址id
				var addressId = $("[name ='isChick']:checked").val()
				var payType = $("[name ='zhifu_ssn']:checked").val()

				$.get({
					url:"http://192.168.1.160:8088/order/createOrder.do",
                    dataType:"json",
                    data:{"addressId":addressId,"payType":payType,"flag":flag},
                    success:function (data) {
                        if(data.code==200){//请求成功
                            alert("生成订单成功");
                            sessionStorage.setItem("orderId",data.data.orderId)
                            sessionStorage.setItem("money",tomoney)
                            location.href = "zhifu.html"
                        }else if (data.code==2000) {
                            alert(data.message);
                        }else if(data.code==300){
                            alert("请求处理中 不要多次点击");
                        }
                        initCart()
                    },error:function () {
                        alert("生成订单异常");
                    }
				})



            }













		</script>



	</body>

</html>
